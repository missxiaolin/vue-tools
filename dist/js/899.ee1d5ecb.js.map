{"version":3,"file":"js/899.ee1d5ecb.js","mappings":"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","sources":["webpack://a/./src/views/editorShow.vue","webpack://a/src/views/editorShow.vue","webpack://a/./src/views/editorShow.vue?72e1","webpack://a/./src/views/editorShow.vue?11ee"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"fabric-top\"},[_c('div',{staticClass:\"btn\"},[_c('el-color-picker',{attrs:{\"show-alpha\":\"\"},on:{\"change\":_vm.changeColor},model:{value:(_vm.color),callback:function ($$v) {_vm.color=$$v},expression:\"color\"}}),_c('el-select',{attrs:{\"placeholder\":\"请选择\"},on:{\"change\":_vm.changeObject},model:{value:(_vm.value),callback:function ($$v) {_vm.value=$$v},expression:\"value\"}},_vm._l((_vm.objects),function(item){return _c('el-option',{key:item.data.id,attrs:{\"label\":item.data.name,\"value\":item.data.id}})}),1),_c('el-tooltip',{staticClass:\"item\",attrs:{\"content\":\"测试\",\"placement\":\"top-end\"}},[_c('span',{on:{\"click\":_vm.clearDesign}},[_c('i',{staticClass:\"el-icon-folder-delete\"})])]),_c('el-tooltip',{staticClass:\"item\",attrs:{\"content\":\"返回编辑\",\"placement\":\"top-end\"}},[_c('span',{on:{\"click\":_vm.backDesign}},[_c('i',{staticClass:\"el-icon-edit-outline\"})])])],1)]),_vm._m(0)])\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"fabric-con\"},[_c('div',{staticClass:\"fabric-body\",attrs:{\"id\":\"canvas-box\"}},[_c('canvas',{attrs:{\"id\":\"showCanvas\"}})])])\n}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"content\">\n    <div class=\"fabric-top\">\n      <div class=\"btn\">\n        <el-color-picker\n          v-model=\"color\"\n          show-alpha\n          @change=\"changeColor\"\n        ></el-color-picker>\n        <el-select v-model=\"value\" placeholder=\"请选择\" @change=\"changeObject\">\n          <el-option\n            v-for=\"item in objects\"\n            :key=\"item.data.id\"\n            :label=\"item.data.name\"\n            :value=\"item.data.id\"\n          >\n          </el-option>\n        </el-select>\n        <el-tooltip class=\"item\" content=\"测试\" placement=\"top-end\">\n          <span @click=\"clearDesign\"\n            ><i class=\"el-icon-folder-delete\"></i\n          ></span>\n        </el-tooltip>\n        <el-tooltip class=\"item\" content=\"返回编辑\" placement=\"top-end\">\n          <span @click=\"backDesign\"><i class=\"el-icon-edit-outline\"></i></span>\n        </el-tooltip>\n      </div>\n    </div>\n    <div class=\"fabric-con\">\n      <div class=\"fabric-body\" id=\"canvas-box\">\n        <canvas id=\"showCanvas\"></canvas>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { fabric } from \"fabric\";\nimport echarts from \"echarts\";\nexport default {\n  created() {},\n  mounted() {\n    this.init();\n  },\n  data() {\n    return {\n      design: \"\",\n      objects: [],\n      originalObj: [],\n      value: \"\",\n      color: \"\",\n      index: \"\",\n    };\n  },\n  methods: {\n    init: function () {\n      let _this = this;\n      _this.design = new fabric.Canvas(\"showCanvas\", {\n        backgroundColor: \"\",\n        selection: false,\n      });\n      _this.design.hoverCursor = \"default\"; // 设置对象hover的光标为默认\n      let dom = document.getElementById(\"canvas-box\");\n\n      _this.design.setWidth(dom.offsetWidth - 30);\n      _this.design.setHeight(dom.offsetHeight - 30);\n      _this.design.on(\"mouse:wheel\", function (opt) {\n        console.log(this);\n        var zoomPoint = new fabric.Point(\n          _this.design.width / 2,\n          _this.design.height / 2\n        );\n        var delta = opt.e.deltaY;\n        var zoom = _this.design.getZoom();\n        zoom *= 0.999 ** delta;\n        if (zoom > 20) zoom = 20;\n        if (zoom < 0.01) zoom = 0.01;\n        this.zoomToPoint(zoomPoint, zoom);\n        // this.setZoom(zoom);\n        opt.e.preventDefault();\n        opt.e.stopPropagation();\n        _this.viewportTransform = this.viewportTransform;\n      });\n      if (sessionStorage.getItem(\"canvasDesign\")) {\n        _this.originalObj = JSON.parse(\n          sessionStorage.getItem(\"canvasDesign\")\n        ).objects;\n        _this.zoomToFitCanvas();\n        window.onresize = function () {\n          _this.design.setWidth(dom.offsetWidth - 30);\n          _this.design.setHeight(dom.offsetHeight - 30);\n          _this.resizeCanvas();\n        };\n        //以下是加载自带的绘图出来的\n        // _this.design.loadFromJSON(JSON.parse(sessionStorage.getItem(\"canvasDesign\")), function() {\n        //     _this.zoomToFitCanvas();\n        //     window.onresize=function(){\n        //         _this.resizeCanvas();\n        //     };\n        //     //test\n        //     _this.test();\n        // });\n      }\n    },\n\n    addObject: function (object) {\n      let _this = this;\n      object.toObject = (function (toObject) {\n        //赋值自定义属性\n        return function (properties) {\n          return fabric.util.object.extend(toObject.call(this, properties), {\n            data: this.data,\n          });\n        };\n      })(object.toObject);\n      object.set(\"selectable\", false); //设置禁止编辑\n      this.design.add(object);\n    },\n    getSvg: function (json) {\n      console.log(json);\n      let _this = this;\n      new fabric.Image.fromURL(\"images/wechat.svg\", function (object) {\n        object[\"data\"] = json.data;\n        console.log(object);\n        object.scale(1).set({\n          left: json.left,\n          top: json.top,\n        });\n        _this.addObject(object);\n      });\n    },\n    getCanvas: function (json, zoom) {\n      let _this = this;\n      var canvas = document.createElement(\"canvas\");\n      canvas.width = json.width ? json.width * zoom : 100;\n      canvas.height = json.height ? json.height * zoom : 100;\n      var myChart = echarts.init(canvas, null, { devicePixelRatio: 2 });\n      var options = json.data.options || {};\n      myChart.setOption(options, true);\n      var CanvasRect = fabric.util.createClass(fabric.Rect, {\n        type: \"canvasRect\",\n        initialize: function (options) {\n          options || (options = {});\n          this.callSuper(\"initialize\", options);\n          // this.set('label', options.label || '');\n        },\n        toObject: function () {\n          return fabric.util.object.extend(this.callSuper(\"toObject\"), {\n            // label: this.get('label'),\n          });\n        },\n        _render: function (ctx) {\n          this.callSuper(\"_render\", ctx);\n          var offcanvas = myChart.getRenderedCanvas({\n            pixelRatio: 2,\n            backgroundColor: \"\",\n          });\n          //在画布上定位图像，并规定图像的宽度和高度： ctx.drawImage(img,x,y,width,height);\n          ctx.drawImage(\n            offcanvas,\n            -(json.width / 2),\n            -(json.height / 2),\n            json.width,\n            json.height\n          );\n        },\n      });\n      return new CanvasRect(json);\n    },\n    resizeCanvas: function () {\n      let dom = document.getElementById(\"canvas-box\");\n      this.design.setWidth(dom.offsetWidth);\n      this.design.setHeight(dom.offsetHeight);\n      //先还原缩放比例与位置\n      this.design.setZoom(1);\n      this.design.absolutePan({ x: 0, y: 0 });\n      //缩放移动视图，使其适应Canvas大小\n      this.zoomToFitCanvas();\n    },\n    //缩放移动视图，使其适应Canvas大小\n    zoomToFitCanvas: function () {\n      let _this = this;\n\n      let object = \"\",\n        rect = {},\n        minX,\n        minY,\n        maxX,\n        maxY;\n      //遍历所有对对象，获取最小坐标，最大坐标\n      if (_this.originalObj.length > 0) {\n        for (let i = 0; i < _this.originalObj.length; i++) {\n          rect = _this.originalObj[i];\n          if (i == 0) {\n            minX = rect.left;\n            minY = rect.top;\n            maxX = rect.left + rect.width;\n            maxY = rect.top + rect.height;\n          } else {\n            minX = Math.min(minX, rect.left);\n            minY = Math.min(minY, rect.top);\n            maxX = Math.max(maxX, rect.left + rect.width);\n            maxY = Math.max(maxY, rect.top + rect.height);\n          }\n        }\n        //计算平移坐标\n        var panX = (maxX - minX - _this.design.width) / 2 + minX;\n        var panY = (maxY - minY - _this.design.height) / 2 + minY;\n        //开始平移\n        _this.design.absolutePan({ x: panX, y: panY });\n\n        //计算缩放比例\n        var zoom = Math.min(\n          _this.design.width / (maxX - minX),\n          _this.design.height / (maxY - minY)\n        );\n        //计算缩放中心\n        var zoomPoint = new fabric.Point(\n          _this.design.width / 2,\n          _this.design.height / 2\n        );\n        //开始缩放\n        _this.design.zoomToPoint(zoomPoint, zoom);\n\n        for (let i = 0; i < _this.originalObj.length; i++) {\n          rect = _this.originalObj[i];\n          console.log(rect);\n          if (rect.data && rect.data.type) {\n            switch (rect.data.type) {\n              case \"Line\":\n                //[终止位置，线长，起始位置，top]\n                object = new fabric.Line([left, rect.width, left, top], rect);\n                break;\n              case \"Echart\":\n                object = this.getCanvas(rect, zoom);\n                break;\n              case \"Svg\":\n                this.getSvg(rect);\n                break;\n              default:\n                object = new fabric[rect.data.type](rect);\n                break;\n            }\n            this.addObject(object);\n          }\n        }\n      }\n    },\n\n    //test\n    test: function () {\n      this.objects = this.design.getObjects();\n      console.log(this.objects);\n      console.log(this.originalObj);\n    },\n    changeColor: function (val) {\n      console.log(val);\n      if (this.value) {\n        for (let i = 0; i < this.objects.length; i++) {\n          if (this.value == this.objects[i].data.id) {\n            this.objects[i].set(\"fill\", val);\n            this.design.renderAll();\n          }\n        }\n        console.log(this.objects);\n      }\n    },\n    changeObject: function () {},\n    //返回编辑\n    backDesign: function () {\n      this.$router.push({ path: \"/editor\" });\n    },\n    clearDesign: function () {\n      this.test();\n      // console.log(this.design.getObjects())\n    },\n  },\n  components: {},\n};\n</script>\n<style lang=\"scss\" scoped>\n.content {\n  width: 100%;\n  height: 100%;\n  background: #061c47;\n  .fabric-top {\n    width: 100%;\n    height: 60px;\n    font-size: 16px;\n    background: #052b62;\n    text-align: right;\n    padding: 0 20px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    .item {\n      color: #dde4f6;\n      margin-left: 20px;\n      font-size: 30px;\n      line-height: 60px;\n      cursor: pointer;\n    }\n  }\n  .fabric-con {\n    width: 100%;\n    height: calc(100% - 60px);\n    display: flex;\n  }\n  .fabric-body {\n    width: 100%;\n    height: 100%;\n    padding: 15px;\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./editorShow.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./editorShow.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./editorShow.vue?vue&type=template&id=bdfab72a&scoped=true&\"\nimport script from \"./editorShow.vue?vue&type=script&lang=js&\"\nexport * from \"./editorShow.vue?vue&type=script&lang=js&\"\nimport style0 from \"./editorShow.vue?vue&type=style&index=0&id=bdfab72a&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bdfab72a\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","changeColor","model","value","color","callback","$$v","expression","changeObject","_l","objects","item","key","data","id","name","clearDesign","backDesign","_m","staticRenderFns","created","mounted","design","originalObj","index","methods","init","_this","backgroundColor","selection","console","zoom","opt","sessionStorage","window","addObject","object","getSvg","left","top","getCanvas","canvas","devicePixelRatio","myChart","type","initialize","options","toObject","_render","pixelRatio","ctx","offcanvas","json","resizeCanvas","x","y","zoomToFitCanvas","minX","minY","maxX","maxY","rect","test","path","components","component"],"sourceRoot":""}